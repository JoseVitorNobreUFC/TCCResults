// @ts-nocheck
export function getRotatingApiKey(provider: string): string {
  if (provider !== 'openai' && provider !== 'anthropic') {
    throw new Error(`No rotation implemented for provider: ${provider}`)
  }
  const keys = []
  if (provider === 'openai') {
    if (env.OPENAI_API_KEY_1) keys.push(env.OPENAI_API_KEY_1)
    if (env.OPENAI_API_KEY_2) keys.push(env.OPENAI_API_KEY_2)
    if (env.OPENAI_API_KEY_3) keys.push(env.OPENAI_API_KEY_3)
  } else if (provider === 'anthropic') {
    if (env.ANTHROPIC_API_KEY_1) keys.push(env.ANTHROPIC_API_KEY_1)
    if (env.ANTHROPIC_API_KEY_2) keys.push(env.ANTHROPIC_API_KEY_2)
    if (env.ANTHROPIC_API_KEY_3) keys.push(env.ANTHROPIC_API_KEY_3)
  }
  if (keys.length === 0) {
    throw new Error(
      `No API keys configured for rotation. Please configure ${provider.toUpperCase()}_API_KEY_1, ${provider.toUpperCase()}_API_KEY_2, or ${provider.toUpperCase()}_API_KEY_3.`
    )
  }
  const currentMinute = new Date().getMinutes()
  const keyIndex = currentMinute % keys.length
  return keys[keyIndex]
}